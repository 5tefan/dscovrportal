"use strict";angular.module("dscovrDataApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngQuickDate"]).config(["$routeProvider","ngQuickDateDefaultsProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/vis",{redirectTo:"/vis/summary"}).when("/vis/summary/:arg?/:argg?",{templateUrl:"views/vis/summary.html",controller:"VisSummaryCtrl"}).when("/vis/ts/:arg?/:argg?/:arggg?",{templateUrl:"views/vis/ts.html",controller:"VisTsCtrl"}).when("/vis/scatter/:arg?/:argg?/:arggg?",{templateUrl:"views/vis/scatter.html",controller:"VisScatterCtrl"}).when("/vis/event/:arg?/:argg?",{templateUrl:"views/vis/event.html",controller:"VisEventCtrl"}).when("/download/:arg?/:argg?",{templateUrl:"views/download.html",controller:"DownloadCtrl"}).otherwise({redirectTo:"/"});var c=moment.utc("02-03-2015","DD-MM-YYYY"),d=moment.utc().subtract(1,"days").startOf("day");b.set("dateFilter",function(a){return moment(a).isBetween(c,d)}),b.set("placeholder","---------------")}]),angular.module("dscovrDataApp").controller("MainCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.scrollTo=function(a){b.hash(a),c()}}]),angular.module("dscovrDataApp").controller("NavCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path().split("/")[1]},"function"==typeof gas&&$rootScope.$on("$routeChangeSuccess",function(){gas("_","pageview",b.url())})}]),angular.module("dscovrDataApp").controller("DownloadCtrl",["$scope","$routeParams","$cookieStore","$location","$route","dscovrDataAccess",function(a,b,c,d,e,f){f.getProducts().then(function(c){if(b.argg){var d=b.argg.split(";");a.products=c.map(function(a){return d.indexOf(a.product)>-1&&(a.selected=!0),a})}else a.products=c.map(function(a){return a.selected=!0,a})}),a.parse_arg=function(b){if(b){var c=b.split(";");2!=c.length||isNaN(c[0])||isNaN(c[1])||(f.getFiles(c[0],c[1]).then(function(b){a.files=b}),a.predef_time=c)}},a.get_selected_products=function(){var b=[];for(var c in a.products)a.products[c].selected&&b.push(a.products[c].product);return b},a.make_wget=function(){if(a.files){var b=a.get_selected_products(),c=[];c.push("wget");for(var d in a.files)for(var e in b)c.push(a.files[d][b[e]]);return c.join(" ")}};var g=e.current;a.$on("$locationChangeSuccess",function(){"DownloadCtrl"==e.current.$$route.controller&&(e.current=g)}),a.selected_products_onchange=function(){if(a.products){var b=a.get_selected_products();d.url("/download/"+a.predef_time.join(";")+"/"+b.join(";")),d.replace()}},a.$on("datechange",function(b,c){if(a.products){var e=a.get_selected_products();d.url("/download/"+c.join(";")+"/"+e.join(";")),a.parse_arg(c.join(";"))}}),a.parse_arg(b.arg)}]),angular.module("dscovrDataApp").controller("VisSummaryCtrl",["$scope","$routeParams","$cookieStore","$location","$route","dscovrUtil",function(a,b,c,d,e,f){a.summary_frame_info={"6h":{dt:864e5,src:"plots/dscovr_6hr_plots/{{year}}/{{month}}/{{year}}{{month}}{{day}}{{hour}}-6hr.png"},"1d":{dt:864e5,src:"plots/dscovr_1day_plots/{{year}}/{{month}}/{{year}}{{month}}{{day}}-day.png"},"3d":{dt:2592e5,src:"plots/dscovr_3day_plots/{{year}}/{{year}}{{month}}{{day}}-3day.png"},"7d":{dt:6048e5,src:"plots/dscovr_7day_plots/{{year}}/{{year}}{{month}}{{day}}-7day.png"},"1m":{dt:24192e5,src:"plots/dscovr_month_plots/{{year}}/{{year}}{{month}}-month.png"}},a.parse_args=function(b,c){switch(b){case"6h":case"1d":case"3d":case"7d":case"1m":a.frame_size=b,a.summary_date=f.dateInRange(c)?moment.utc(+c).toDate():moment.utc().subtract(1,"days").toDate(),"3d"==a.frame_size||"7d"==a.frame_size?a.summary_file_date=moment.utc(f.getMissionBegin().valueOf()+a.summary_frame_info[a.frame_size].dt*Math.floor((a.summary_date.valueOf()-f.getMissionBegin().valueOf())/a.summary_frame_info[a.frame_size].dt)):"1d"==a.frame_size||"6h"==a.frame_size?a.summary_file_date=moment.utc(a.summary_date).startOf("day"):"1m"==a.frame_size&&(a.summary_file_date=moment.utc(a.summary_date).startOf("month")),"1m"==a.frame_size?(a.summary_prev_ms=moment.utc(a.summary_date).subtract(1,"months").valueOf(),a.summary_end_ms=moment.utc(a.summary_file_date).add(1,"months").valueOf()):(a.summary_prev_ms=+a.summary_date-a.summary_frame_info[a.frame_size].dt,a.summary_end_ms=+a.summary_file_date+a.summary_frame_info[a.frame_size].dt);break;default:d.url("/vis/summary/7d"),d.replace(),a.parse_args("7d")}},a.parse_args(b.arg,b.argg);var g=e.current;a.$on("$locationChangeSuccess",function(){"VisSummaryCtrl"==e.current.$$route.controller&&(e.current=g)}),a.locationchange=function(b,c){a.frame_size=b||a.frame_size;var e=c||a.summary_date.valueOf();d.url("/vis/summary/"+a.frame_size+"/"+e),a.parse_args(a.frame_size,e)},a.get_plotsrc=function(){if(a.frame_size){var b=a.summary_frame_info[a.frame_size].src;return b=b.split("{{year}}").join(a.summary_file_date.format("YYYY")),b=b.split("{{month}}").join(a.summary_file_date.format("MM")),b=b.split("{{day}}").join(a.summary_file_date.format("DD"))}},a.get_plotsrc_6h=function(b){if(a.frame_size){var c=a.summary_frame_info[a.frame_size].src;return c=c.split("{{year}}").join(a.summary_file_date.format("YYYY")),c=c.split("{{month}}").join(a.summary_file_date.format("MM")),c=c.split("{{day}}").join(a.summary_file_date.format("DD")),c=c.split("{{hour}}").join(10>b?"0"+b:b)}}}]),angular.module("dscovrDataApp").controller("VisEventCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location","$rootScope",function(a,b,c,d,e,f){a.can_plot=!1,a.timerange_ready=!1,a.$on("timerangeReady",function(){a.timerange_ready=!0}),a.error="",a.info="";var g=function(b){a.error+=b+"\n"},h=function(b){a.info+=b+"\n"},i=function(b){h("evaluating request"),a.$broadcast("evalTimerange",function(c){return console.log("got time range: "+c),a.timerange=c,a.timerange[0]&&a.timerange[1]?a.timerange[0]>=a.timerange[1]?(g("end date is not after start date"),void(a.can_plot=!1)):moment(a.timerange[0]).add(1,"months").isBefore(a.timerange[1])?(g("queries larger than 1 month not supported"),void(a.can_plot=!1)):void a.$broadcast("evalConditions",function(c){c?(a.condition_str=c,a.can_plot=!0,b&&b()):(a.can_plot=!1,g("No valid conditions"))}):(g("no time range selected"),void(a.can_plot=!1))})},j=function(){var b=a.condition_str,d=a.timerange.slice();h("requesting data"),c.getValues3("",d,b).then(function(c){h("data received, plot is below"),a.plot={data:c,title:b}},g)};if(a.go=function(){i(function(){var b="/vis/event/"+a.timerange.join(":")+"/"+a.condition_str;e.url()!=b?a.can_plot&&e.url(b):a.can_plot&&g("request unchanged and already fulfilled")})},c.getParameters2().then(function(a){f.params=a},g),d.arg&&(a.predef_time=d.arg.split(":").map(Number)),d.argg&&(a.predef_cond=d.argg),d.arg&&d.argg){var k=function(){f.params&&a.timerange_ready?i(j):b(k,500)};k()}}]),angular.module("dscovrDataApp").directive("conditionContainer",["$timeout",function(){return{template:'<div class="row"><div class="col-xs-5"><h5>Constrain where:</h5></div><div class="col-xs-2"><a class="btn btn-default btn-sm" ng-click=addCondition()> + constraint </a></div></div><div class="row condition-edit" ng-repeat="condition in conditions"><div condition-edit params="params" condition="condition" rm-condition="rmCondition($index)"></div></div>',restrict:"A",scope:{predef:"="},link:function(a){a.conditions=[];var b=a.$watch("predef",function(){a.predef&&(console.log(a.predef),a.predef.split(";").map(function(b){a.conditions.push({predef:b})}),b())});a.addCondition=function(){var b={};a.conditions.push(b)},a.rmCondition=function(b){a.conditions.splice(b,1)},a.evalConditions=function(){var b="";for(var c in a.conditions)a.conditions[c].construct?b+=(b?";":"")+a.conditions[c].construct:a.conditions[c].predef&&(b+=(b?";":"")+a.conditions[c].predef);return b},a.$on("evalConditions",function(b,c){c(a.evalConditions())})}}}]),angular.module("dscovrDataApp").directive("conditionEdit",function(){return{template:'<div class="no-padding-right col-xs-3"><select class="form-control condition-edit-select" ng-model="prod" ng-options="prod for prod in keys(params)"><option value="" disabled selected>-product-</option></select></div><div class="no-padding-right no-padding-left col-xs-3"><select class="form-control condition-edit-select" ng-model="param" ng-options="param for param in keys(params[prod])"><option value="" disabled selected>-variable-</option></select></div><div class="no-padding-right no-padding-left col-xs-2"><select class="form-control condition-edit-select" ng-model="relation"><option value="gt"> &gt; </option><option value="lt"> &lt; </option><option value="eq"> = </option><option value="ge"> &gt;= </option><option value="le"> &lt;= </option></select></div><div class="no-padding-right no-padding-left col-xs-2"><input type="number" class="form-control" placeholder="val" ng-model="value" ng-required></div><div class="col-xs-2"><a class="btn btn-default" ng-click=rmCondition($index)><span class="glyphicon glyphicon-remove"></span></a></div>',restrict:"A",scope:{condition:"=",rmCondition:"&"},link:function(a){var b=a.$watch("$root.params",function(){if(a.$root.params){a.params=a.$root.params;var c=a.$watch("selection.predef",function(){if(a.condition&&a.condition.predef){var b=a.condition.predef.split(":");a.prod=b[0],a.param=b[1],a.relation=b[2],a.value=+b[3],c()}});b()}});a.keys=function(a){return a?Object.keys(a):void 0},a.isConditionValid=function(){return a.params&&a.condition?a.params[a.prod]&&"number"==typeof a.value:!1},a.$watchGroup(["prod","param","relation","value"],function(){a.condition.construct=a.isConditionValid()?[a.prod,a.param,a.relation,a.value].join(":"):""})}}}),angular.module("dscovrDataApp").controller("VisTsCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location","$rootScope",function(a,b,c,d,e,f){a.can_plot=!1,a.timerange_ready=!1,a.$on("timerangeReady",function(){a.timerange_ready=!0}),a.error="",a.info="";var g=function(b){a.error+=b+"\n"},h=function(b){a.info+=b+"\n"},i=function(b){h("evaluating request"),a.$broadcast("evalTimerange",function(c){return console.log("got time range: "+c),a.timerange=c,a.timerange[0]&&a.timerange[1]?a.timerange[0]>=a.timerange[1]?(g("end date is not after start date"),void(a.can_plot=!1)):moment(a.timerange[0]).add(1,"months").isBefore(a.timerange[1])?(g("queries larger than 1 month not supported"),void(a.can_plot=!1)):(a.pane_strs="",void a.$broadcast("evalNumPanes",function(c){console.log("evalPanes expecting # panes: "+c);var d=0;a.$broadcast("evalParameters",function(e){e&&(++d,a.pane_strs+=(a.pane_strs?";;":"")+e),d==c&&(console.log("evalPanes received all responses"),a.pane_strs?(a.can_plot=!0,a.$broadcast("evalConditions",function(c){a.condition_str=c,b&&b()})):g("please enter at least 1 valid pane"))})})):(g("no time range selected"),void(a.can_plot=!1))})},j=function(){a.plots=[];var b,d=a.timerange.slice(),e=a.condition_str;a.pane_strs.split(";;").map(function(f,i){if(f){console.log("processing panel: "+(i+1)+" : "+f);var j,k="linear",l=[],m=f.split("*");if(b=m[0],!b)return void g("panel "+(i+1)+": nothing to do");m[1]&&(k="log"==m[1]?"log":"linear"),";"==b.charAt(b.length-1)&&(b=b.slice(0,-1)),j=b.split(";").map(function(b){var c=b.split(":");return l.push(c[1]+" ["+a.params[c[0]][c[1]]+"]"),c[1]}),l.join(", "),h("panel "+(i+1)+": requesting data"),c.getValues3(b,d,e).then(function(c){h("panel "+(i+1)+": data received, parsing");var e=0,f=6e4,m=!1,n=!1,o=function(){for(;e<c.length;){var a=0;if(Object.keys(c[e]).map(function(b){-9999==+c[e][b]|-999==+c[e][b]&&(a++,c[e][b]=null)}),m=Boolean(a==j.length),m&&n)c.splice(e,1),setTimeout(o,1);else{var b=Boolean(c[e+1]&&c[e+1].time-c[e].time>f);b&&!m?(c.splice(e+1,0,c[e]),Object.keys(c[e+1]).map(function(a){c[e+1][a]="time"==a?+c[e+1][a]+f:null}),n=!0,e+=2):(c[e].time=new Date(+c[e].time),n=m,e++)}}};if(o(),c.length>1){h("panel "+(i+1)+": plot will appear below");var p=b+" from "+d.map(Date).join(" to ");a.plots[i]={y_accessor:j,data:c,title:p,y_scale_type:k,y_label:l}}else g("Panel "+(i+1)+": no data matching request")},function(a){g("Panel "+(i+1)+": "+a)})}})};if(a.go=function(){i(function(){var b="/vis/ts/"+a.pane_strs+"/"+a.timerange.join(":")+"/"+a.condition_str;e.url()!=b?a.can_plot&&e.url(b):g("request unchanged and aready fulfilled")})},c.getParameters2().then(function(a){f.params=a},g),d.arg&&(a.predef_param=d.arg),d.argg&&(a.predef_time=d.argg.split(":").map(Number)),d.arggg&&(a.predef_cond=d.arggg),d.arg&&d.argg){var k=function(){f.params&&a.timerange_ready?i(j):b(k,500)};k()}}]),angular.module("dscovrDataApp").controller("VisScatterCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location","$rootScope",function(a,b,c,d,e,f){a.can_plot=!1,a.timerange_ready=!1,a.$on("timerangeReady",function(){a.timerange_ready=!0}),a.error="",a.info="",a.plot={};var g=function(b){a.error+=b+"\n"},h=function(b){a.info+=b+"\n"},i=function(b){h("evaluating request"),a.$broadcast("evalTimerange",function(c){return console.log("got time range: "+c),a.timerange=c,a.timerange[0]&&a.timerange[1]?a.timerange[0]>=a.timerange[1]?(g("end date is not after start date"),void(a.can_plot=!1)):moment(a.timerange[0]).add(1,"months").isBefore(a.timerange[1])?(g("queries larger than 1 month not supported"),void(a.can_plot=!1)):void a.$broadcast("evalParameters",function(c){a.selection_str=c,a.selection_str?(a.can_plot=!0,a.$broadcast("evalConditions",function(c){a.condition_str=c,b&&b()})):g("Please select two variables to plot")}):(g("no time range selected"),void(a.can_plot=!1))})},j=function(){var b,d,e,f=a.selection_str,i=a.timerange.slice(),j=a.condition_str;b=f.split(";");var k=[];d=b[0].split("*");var e=d[0].split(":"),l="log"==d[1]?"log":"linear",m=e[0],n=e[1];k.push(d[0]),d=b[1].split("*"),e=d[0].split(":");var o="log"==d[1]?"log":"linear",p=e[0],q=e[1];k.push(d[0]);var r=n+" ["+a.params[m][n]+"]",s=q+" ["+a.params[p][q]+"]";h("requesting data"),c.getValues3(k.join(";"),i,j).then(function(b){h("data received, parsing");var c=0,d=!1,e=function(){for(;c<b.length;)d=!1,Object.keys(b[c]).map(function(a){-9999==+b[c][a]|-999==+b[c][a]&&(d=!0)}),d?(b.splice(c,1),setTimeout(e,1)):(b[c].time=new Date(+b[c].time),c++)};e(),b.length>0?(h("plot will appear below"),a.plot={data:b,title:q+" vs "+n,y_accessor:q,x_accessor:n,y_scale_type:o,x_scale_type:l,y_label:s,x_label:r,download_link:{timerange:i,params:q==n?n:n+";"+q}}):g("no data matching request")},g)};if(a.go=function(){i(function(){var b="/vis/scatter/"+a.selection_str+"/"+a.timerange.join(":")+"/"+a.condition_str;e.url()!=b?a.can_plot&&e.url(b):g("request unchanged and aready fulfilled")})},c.getParameters2().then(function(a){f.params=a},g),d.arg&&(a.predef_selec=d.arg),d.argg&&(a.predef_time=d.argg.split(":").map(Number)),d.arggg&&(a.predef_cond=d.arggg),d.arg&&d.argg){var k=function(){a.params&&a.timerange_ready?i(j):b(k,500)};k()}}]),angular.module("dscovrDataApp").directive("tsParamContainer",function(){return{template:'<div class="row ts-param-pane" ng-repeat="pane in panes track by $index"><div ts-param-pane predef="pane" rm-pane="rmPane($index)" position="$index+1"></div><div class="ts-param-pane-remove-pane" class="col-xs-2"><a ng-if="panes.length > 1" class="btn btn-default" ng-click=rmPane($index)> - panel </a></div></div><div class="ts-param-pane-add-pane" class="col-xs-2"><a class="btn btn-default" ng-click=addPane()> + panel </a></div>',restrict:"A",scope:{predef:"="},link:function(a){a.panes=[""];var b=a.$watch("predef",function(){a.predef&&(console.log("passing on predef: "+a.predef),a.panes=a.predef.split(";;"),b())});a.addPane=function(){a.panes.push("")},a.rmPane=function(b){a.panes.splice(b,1)},a.$on("evalNumPanes",function(b,c){c(a.panes.length)})}}}),angular.module("dscovrDataApp").directive("timeRange",function(){return{template:'<div class="row" style="margin-bottom: 15px; clear: both"><div class="col-xs-12"><h5><span class="glyphicon glyphicon-calendar"></span> Begin Date</h5><quick-datepicker ng-model="selected_begin" on-change="onchange_begin()" time-format="HH:mm"></quick-datepicker></div><div class="col-xs-12"><h5><span class="glyphicon glyphicon-calendar"></span> End Date</h5><quick-datepicker ng-model="selected_end" on-change="onchange_end()" time-format="HH:mm"></quick-datepicker></div></div>',restrict:"A",scope:{predef:"="},link:function(a){a.selected_begin=moment(14389272e5).toDate(),a.selected_end=moment(14400504e5).toDate(),a.time_difference=a.selected_end.getTime()-a.selected_begin.getTime(),a.$on("evalTimerange",function(b,c){c([a.selected_begin.getTime(),a.selected_end.getTime()])});var b=a.$watch("predef",function(){a.predef&&(a.selected_begin=new Date(+a.predef[0]),a.selected_end=new Date(+a.predef[1]),b())});a.onchange_begin=function(){if(moment(a.selected_begin).isSameOrAfter(a.selected_end)){var b=moment(a.selected_begin).add(a.time_difference,"ms");a.selected_end=dscovrUtil.getMissionEnd().isSameOrAfter(b)?b.toDate():dscovrUtil.getMissionEnd().toDate()}else a.time_difference=a.selected_end.getTime()-a.selected_begin.getTime()},a.onchange_end=function(){if(moment(a.selected_end).isSameOrBefore(a.selected_begin)){var b=moment(a.selected_end).subtract(a.time_difference,"ms");a.selected_begin=dscovrUtil.getMissionBegin().isSameOrBefore(b)?b.toDate():dscovrUtil.getMissionBegin().toDate()}else a.time_difference=a.selected_end.getTime()-a.selected_begin.getTime()},a.$emit("timerangeReady")}}}),angular.module("dscovrDataApp").directive("tsParamPane",function(){return{template:'<div class="col-xs-12"><div class="row margin-b10"><div class="col-xs-5 ts-param-pane-panel-title"><h4 class="ts-param-pane-panel-title"> Panel {{position}}</h4></div><div class="col-xs-4"><a class="btn btn-default btn-sm" ng-click=addSelection()> + param </a></div></div><div class="row pane-edit" ng-repeat="selection in selections track by $index"><div param-edit selection="selection" removable="selections.length > 1" rm-selection="rmSelection($index)"></div></div><form><div class="checkbox"><label><input type="checkbox" ng-model="adv.log">Log scale</label></div></form></div>',restrict:"A",scope:{predef:"=",rmPane:"&",position:"="},link:function(a){a.selections=[{}],a.adv={log:!1};var b=a.$watch("predef",function(){if(a.predef){var c=a.predef.split("*");if(!c[0])return;if(c[1]){var d=c[1];";"==d.charAt(d.length-1)&&(d=d.slice(0,-1)),a.adv.log="log"==d}a.selections=[],c[0].split(";").map(function(b){a.selections.push({predef:b})}),b()}});a.addSelection=function(){a.selections.push({})},a.rmSelection=function(b){a.selections.splice(b,1)},a.getOrCreateConstruct=function(a){return a.construct?a.construct:a.prod&&a.param?a.prod+":"+a.param:""},a.evalParameters=function(){var b="";for(var c in a.selections)b+=(b?";":"")+a.getOrCreateConstruct(a.selections[c]);return a.adv.log&&(b+="*log"),b},a.$on("evalParameters",function(b,c){c(a.evalParameters())})}}}),angular.module("dscovrDataApp").directive("paramEdit",function(){return{template:'<div ng-class="{\'col-xs-10\' : removable, \'col-xs-12\' : !removable}"><select class="form-control param-edit-select" ng-model="prod" ng-options="prod for prod in keys(params)"><option value="" disabled selected>-product-</option></select><select class="form-control param-edit-select" ng-model="param" ng-options="param for param in keys(params[prod])"><option value="" disabled selected>-variable-</option></select></div><div class="col-xs-2" ng-if="removable"><a class="btn btn-default" ng-click=rmSelection()><span class="glyphicon glyphicon-remove"></span></a></div>',restrict:"A",scope:{selection:"=",removable:"=",rmSelection:"&"},link:function(a){var b=a.$watch("$root.params",function(){if(a.$root.params){a.params=a.$root.params;var c=a.$watch("selection.predef",function(){if(a.selection&&a.selection.predef){var b=a.selection.predef.split(":");a.prod=b[0],a.param=b[1],c()}});b()}});a.$watchGroup(["prod","param"],function(){a.selection.construct=a.param&&a.prod?[a.prod,a.param].join(":"):""}),a.keys=function(a){return a?Object.keys(a):void 0}}}}),angular.module("dscovrDataApp").directive("scatterParamPane",function(){return{template:'<div class="row paneEdit"><div class="col-xs-3 no-padding-right"><h4> x-axis: </h4></div><div class="col-xs-9 no-padding-left"><div param-edit selection="selection_x" removable="false"></div></div><form class="col-xs-5 col-xs-offset-3 clear"><div class="checkbox"><label><input type="checkbox" ng-model="selection_x.log">Log x scale</label></div></form></div><div class="row paneEdit"><div class="col-xs-3 no-padding-right"><h4> y-axis: </h4></div><div class="col-xs-9 no-padding-left"><div param-edit selection="selection_y" removable="false"></div></div><form class="col-xs-5 col-xs-offset-3 clear"><div class="checkbox"><label><input type="checkbox" ng-model="selection_y.log">Log y scale</label></div></form></div>',restrict:"A",scope:{predef:"="},link:function(a){a.selection_y={},a.selection_x={};var b=a.$watch("predef",function(){if(a.predef){var c=a.predef.split(";");if(c[0]){var d=c[0].split("*");a.selection_x.log="log"==d[1],a.selection_x.predef=d[0]}if(c[1]){var d=c[1].split("*");a.selection_y.log="log"==d[1],a.selection_y.predef=d[0]}b()}});a.getOrCreateConstruct=function(a){return a.construct?a.construct+(a.log?"*log":""):a.prod&&a.param?a.prod+":"+a.param+(a.log?"*log":""):""},a.evalParameters=function(){var b=a.getOrCreateConstruct(a.selection_x),c=a.getOrCreateConstruct(a.selection_y);return b&&c?[b,c].join(";"):void 0},a.$on("evalParameters",function(b,c){c(a.evalParameters())})}}}),angular.module("dscovrDataApp").factory("dscovrDataAccess",["$http","$q","$timeout",function(a,b,c){var d="//gis.ngdc.noaa.gov/dscovr-data-access/",e=function(d){function e(){a.get(d).success(function(a){g.resolve(a)}).error(function(a){3>f?(f++,c(e,500)):g.reject(a?a.error+" ("+a.status+") : "+a.message:"could not contact data server, please try again later")})}console.log(d);var f=0,g=b.defer();return e(),g.promise};return{getProducts:function(){return a.get(d+"products").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getProducts2:function(){var a=d+"products";return e(a)},getParameters:function(){return a.get(d+"parameters").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getParameters2:function(){var a=d+"parameters";return e(a)},getValues:function(c,e){var f=d+"values?parameters="+c+"&criteria="+e;return console.log(f),a.get(f).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getValues2:function(c,e){function f(){a.get(g).success(function(a){a.length<1?i.reject("no data matching request"):i.resolve(a)}).error(function(a){3>h?(h++,f()):i.reject(a.error+" ("+a.status+") : "+a.message)})}var g=d+"values?parameters="+c+"&criteria="+e;console.log(g);var h=0,i=b.defer();return f(),i.promise},getValues3:function(c,e,f){function g(){a.get(i).success(function(a){a.length<1?k.reject("no data matching request"):k.resolve(a)}).error(function(a){3>j?(j++,g()):k.reject(a?a.error+" ("+a.status+") : "+a.message:"could not contact data server, please try again later")})}var h="m1m:time:ge:"+e[0]+";m1m:time:le:"+e[1]+";",i=d+"values?parameters="+c+"&criteria="+h+f;console.log(i);var j=0,k=b.defer();return g(),k.promise},getFiles:function(c,e){var f=d+"files?start_date="+c+"&end_date="+e;return a.get(f).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getFiles2:function(a,b){var c=d+"files?start_date="+a+"&end_date="+b;return e(c)}}}]),angular.module("dscovrDataApp").directive("tsPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){var c=a.$watch("plot",function(){a.plot&&a.plot.data&&(MG.data_graphic({title:a.plot.title,data:a.plot.data,width:b[0].clientWidth,height:400,right:100,left:90,yax_format:d3.format("e"),target:b[0],x_accessor:"time",y_accessor:a.plot.y_accessor,legend:a.plot.y_accessor,utc_time:!0,area:!1,y_scale_type:a.plot.y_scale_type,y_label:a.plot.y_label,xax_count:10,yax_count:5,x_extended_ticks:!0,y_extended_ticks:!0,min_y_from_data:!0,utc_time:!0,x_rollover_format:function(a){return a.time.toUTCString()+" - "}}),c(),a.plot.data=null)})}}}),angular.module("dscovrDataApp").directive("scatterPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){var c=a.$watch("plot",function(){a.plot&&a.plot.data&&(MG.data_graphic({title:a.plot.title,chart_type:"point",data:a.plot.data,x_label:a.plot.x_label,y_label:a.plot.y_label,left:60,right:60,top:60,bottom:60,width:b[0].clientWidth,height:.8*b[0].clientWidth,target:b[0],x_accessor:a.plot.x_accessor,y_accessor:a.plot.y_accessor,color_accessor:"time",color_range:["red","blue"],y_scale_type:a.plot.y_scale_type,x_scale_type:a.plot.x_scale_type,x_extended_ticks:!0,y_extended_ticks:!0,min_y_from_data:!0,mouseover:function(a,b){this.target.getElementsByClassName("mg-active-datapoint")[0].innerHTML=this.data[0][b].time.toUTCString()+" - "+this.x_accessor+": "+this.data[0][b][this.x_accessor]+", "+this.y_accessor+": "+this.data[0][b][this.y_accessor]}}),c(),a.plot.data=null)})}}}),angular.module("dscovrDataApp").directive("eventPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){a.$watch("plot",function(){a.plot.data&&(a.plot.data.map(function(a){return a.time=new Date(+a.time),a.val=1,a}),MG.data_graphic({title:a.plot.title,chart_type:"point",data:a.plot.data,width:b[0].clientWidth,height:100,target:b[0],x_accessor:"time",y_accessor:"val"}))})}}}),angular.module("dscovrDataApp").directive("downloadTimeRange",function(){return{template:'<div class="row" style="margin-bottom: 15px;"><div class="col-xs-4"><h5><span class="glyphicon glyphicon-calendar"></span> Begin Date</h5><quick-datepicker ng-model="selected_begin" on-change="onchange()" disable-timepicker="true"></quick-datepicker></div><div class="col-xs-6" style="padding:0;margin:0;"><h5><span class="glyphicon glyphicon-calendar"></span> End Date</h5><quick-datepicker ng-model="selected_end" on-change="onchange()" disable-timepicker="true"></quick-datepicker></div></div>',restrict:"A",scope:{predef:"="},link:function(a){var b=a.$watch("predef",function(){a.predef&&(a.selected_begin=new Date(+a.predef[0]),a.selected_end=new Date(+a.predef[1]),b())});a.onchange=function(){a.$emit("datechange",[a.selected_begin.getTime(),a.selected_end.getTime()])},a.selected_begin=moment(14389272e5).toDate(),a.selected_end=moment(a.selected_begin).add(10,"days").toDate(),a.onchange()}}}),angular.module("dscovrDataApp").factory("dscovrUtil",["dscovrDataAccess",function(){var a=moment.utc("02-03-2015","DD-MM-YYYY"),b=moment.utc().subtract(1,"days").startOf("day");return{dateInRange:function(c){return c&&moment.utc(+c).isBetween(a,b)},getMissionBegin:function(){return a},getMissionEnd:function(){return b}}}]),angular.module("dscovrDataApp").directive("statusLog",function(){return{template:'<p style="white-space: pre-line;" class="status-log-box" >{{text}}</p>',restrict:"A",scope:{text:"="},link:function(a,b){a.$watch("text",function(a){a&&$(b).children().scrollTop(1e5)})}}});