"use strict";angular.module("dscovrDataApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngQuickDate"]).config(["$routeProvider","ngQuickDateDefaultsProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/vis",{redirectTo:"/vis/summary"}).when("/vis/summary/:arg?/:argg?",{templateUrl:"views/vis/summary.html",controller:"VisSummaryCtrl"}).when("/vis/ts/:arg?/:argg?",{templateUrl:"views/vis/ts.html",controller:"VisTsCtrl"}).when("/vis/scatter/:arg?/:argg?",{templateUrl:"views/vis/scatter.html",controller:"VisScatterCtrl"}).when("/vis/event/:arg?",{templateUrl:"views/vis/event.html",controller:"VisEventCtrl"}).when("/download/:arg?/:argg?",{templateUrl:"views/download.html",controller:"DownloadCtrl"}).otherwise({redirectTo:"/"});var c=moment.utc("02-03-2015","DD-MM-YYYY"),d=moment.utc("12-13-2015","DD-MM-YYYY");b.set("dateFilter",function(a){return a=moment(a),a.isAfter(c)&&a.isBefore(d)}),b.set("placeholder","---------------")}]),angular.module("dscovrDataApp").controller("MainCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.scrollTo=function(a){b.hash(a),c()}}]),angular.module("dscovrDataApp").controller("NavCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path().split("/")[1]}}]),angular.module("dscovrDataApp").controller("DownloadCtrl",["$scope","$routeParams","$cookieStore","$location","dscovrDataAccess",function(a,b,c,d,e){if(e.getProducts().then(function(c){if(b.argg){var d=b.argg.split(";");a.products=c.map(function(a){return d.indexOf(a.product)>-1&&(a.selected=!0),a})}else a.products=c.map(function(a){return a.selected=!0,a})}),b.arg){var f=b.arg.split(";");2!=f.length||isNaN(f[0])||isNaN(f[1])||(e.getFiles(f[0],f[1]).then(function(b){a.files=b}),a.predef_time=f)}a.make_wget=function(){if(a.files){var b=[];for(var c in a.products)a.products[c].selected&&b.push(a.products[c].product);var d=[];d.push("wget");for(var c in a.files)for(var e in b)d.push(a.files[c][b[e]]);return d.join(" ")}},a.$on("datechange",function(b,c){var e=[];for(var f in a.products)a.products[f].selected&&e.push(a.products[f].product);console.log(c),d.url("/download/"+c.join(";")+"/"+e.join(";"))})}]),angular.module("dscovrDataApp").controller("VisAdvancedCtrl",["$scope","$routeParams","$cookieStore","$location",function(a){a.mission_start=moment.utc("02-03-2015","DD-MM-YYYY"),a.mission_end=moment.utc("12-12-2015","DD-MM-YYYY");moment.range(a.mission_start,a.mission_end);a.make_urldate=function(a){return moment.utc(a).toDate().getTime()/1e5},a.parse_urldate=function(a){return moment.utc(1e5*a)}}]),angular.module("dscovrDataApp").controller("VisSummaryCtrl",["$scope","$routeParams","$cookieStore","$location",function(a,b,c,d){a.mission_start=moment.utc("02-03-2015","DD-MM-YYYY"),a.mission_end=moment.utc("12-12-2015","DD-MM-YYYY");var e=moment.range(a.mission_start,a.mission_end);switch(a.make_urldate=function(a){return moment.utc(a).toDate().getTime()/1e5},a.parse_urldate=function(a){return moment.utc(1e5*a)},a.summary_frame_info={"6h":{dt:864e5,src:"plots/dscovr_6hr_plots/{{year}}/{{month}}/{{year}}{{month}}{{day}}{{hour}}-6hr.png"},"1d":{dt:864e5,src:"plots/dscovr_1day_plots/{{year}}/{{month}}/{{year}}{{month}}{{day}}-day.png"},"3d":{dt:2592e5,src:"plots/dscovr_3day_plots/{{year}}/{{year}}{{month}}{{day}}-3day.png"},"7d":{dt:6048e5,src:"plots/dscovr_7day_plots/{{year}}/{{year}}{{month}}{{day}}-7day.png"},"1m":{dt:27648e5,src:"plots/dscovr_month_plots/{{year}}/{{year}}{{month}}-month.png"}},b.arg){case"6h":case"1d":case"3d":case"7d":case"1m":a.frame_size=b.arg,a.summary_date=moment.utc().subtract(1,"days"),b.argg&&e.contains(a.parse_urldate(b.argg))&&(a.summary_date=a.parse_urldate(b.argg)),a.timestring=a.make_urldate(a.summary_date),a.selected_date=a.summary_date.format("YYYY-MM-DD"),"3d"==a.frame_size||"7d"==a.frame_size?a.summary_file_date=moment.utc(a.mission_start.toDate().getTime()+a.summary_frame_info[a.frame_size].dt*Math.floor((moment.utc(a.selected_date).toDate().getTime()-a.mission_start.toDate().getTime())/a.summary_frame_info[a.frame_size].dt)):"1d"==a.frame_size||"6h"==a.frame_size?a.summary_file_date=moment.utc(a.selected_date).startOf("day"):"1m"==a.frame_size&&(a.summary_file_date=moment.utc(a.selected_date).startOf("month")),a.summary_file_date_prev=moment.utc(a.summary_file_date).subtract(a.summary_frame_info[a.frame_size].dt,"ms"),a.summary_file_date_end=moment.utc(a.summary_file_date).add(a.summary_frame_info[a.frame_size].dt,"ms"),a.summary_file_date_next=moment.utc(a.summary_file_date).add(2*a.summary_frame_info[a.frame_size].dt,"ms");break;default:return void d.url("/vis/summary/7d")}a.dateselect_locationchange=function(){if(a.selected_date){var c=moment(a.selected_date);d.url("/vis/summary/"+b.arg+"/"+a.make_urldate(c))}},a.get_plotsrc=function(){var b=a.summary_frame_info[a.frame_size].src;return b=b.split("{{year}}").join(a.summary_file_date.format("YYYY")),b=b.split("{{month}}").join(a.summary_file_date.format("MM")),b=b.split("{{day}}").join(a.summary_file_date.format("DD"))},a.get_plotsrc_6h=function(b){var c=a.summary_frame_info[a.frame_size].src;return c=c.split("{{year}}").join(a.summary_file_date.format("YYYY")),c=c.split("{{month}}").join(a.summary_file_date.format("MM")),c=c.split("{{day}}").join(a.summary_file_date.format("DD")),c=c.split("{{hour}}").join(10>b?"0"+b:b)}}]),angular.module("dscovrDataApp").controller("VisEventCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location",function(a,b,c,d,e){a.can_plot=!1;var f=function(){a.$broadcast("evalConditions",function(c){c?(a.criteria=c,a.can_plot=!0):(a.can_plot=!1,a.error="please enter at least 1 valid condition!",b(function(){a.error=""},5e3))})},g=function(){f();var b=a.criteria,d=a.timerange_construct;c.getValues("",b+d).then(function(c){a.plots=[];var d={data:c,title:b};a.plots.push(d)})};a.go=function(){f(),a.can_plot&&e.url("/vis/event/"+a.criteria+a.timerange_construct)},d.arg&&(a.predef_cond=[],a.predef_time=[0,0],d.arg.split(";").map(function(b){b=b.split(":"),"time"==b[1]?"ge"==b[2]?a.predef_time[0]=b[3]:a.predef_time[1]=b[3]:a.predef_cond.push(b)}),b(g,1e3)),a.timerange_construct="",c.getParameters().then(function(b){a.params=b})}]),angular.module("dscovrDataApp").directive("conditionContainer",["$timeout",function(){return{template:'<div class="row" style="margin-top: 20px; margin-bottom: 20px;"><div class="col-xs-4"><h3> Select Conditions </h3></div><div class="col-xs-2"><a class="btn btn-default" ng-click=addCondition()> + add condition </a></div></div><div class="row conditionEdit"><div condition-edit params="params" condition="default_condition" removable="false"></div></div><div class="row conditionEdit" ng-repeat="condition in conditions"><div condition-edit params="params" condition="condition" removable="true" rm-condition="rmCondition($index)"></div></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.default_condition={},a.conditions=[];var b=a.$watch("predef",function(){if(a.predef){for(var c in a.predef){var d={prod:a.predef[c][0],param:a.predef[c][1],relation:a.predef[c][2],value:Number(a.predef[c][3])};0==c?a.default_condition=d:a.conditions.push(d)}b()}});a.addCondition=function(){var b={};a.conditions.push(b)},a.rmCondition=function(b){a.conditions.splice(b,1)},a.evalConditions=function(){var b="";a.default_condition.construct&&(b=a.default_condition.construct+";");for(var c in a.conditions)a.conditions[c].construct&&(b+=a.conditions[c].construct+";");return b},a.$on("evalConditions",function(b,c){c(a.evalConditions())})}}}]),angular.module("dscovrDataApp").directive("conditionEdit",function(){return{template:'<div class="row"><div class="no-padding-right col-xs-4"><select class="form-control condition-edit-select" ng-model="prod" ng-options="prod for prod in keys(params)"><option value="" disabled selected>-product-</option></select><select class="form-control condition-edit-select" ng-model="param" ng-options="param for param in keys(params[prod])"><option value="" disabled selected>-variable-</option></select><select class="form-control condition-edit-select" ng-model="relation"><option value="gt"> &gt; </option><option value="lt"> &lt; </option><option value="eq"> = </option><option value="ge"> &gt;= </option><option value="le"> &lt;= </option></select></div><div class="no-padding-left col-xs-2"><form class="form"><div class="form-group"><input type="number" class="form-control" placeholder="value" ng-model="value" ng-required></div></form></div><div class="col-xs-2" ng-if="removable"><a class="btn btn-default" ng-click=rmCondition($index)> - remove condition </a></div></div>',restrict:"A",scope:{params:"=",condition:"=",rmCondition:"&"},link:function(a,b,c){var d=a.$watch("removable",function(){a.removable=a.$eval(c.removable),d()}),e=function(){a.prod=a.condition.prod,a.param=a.condition.param,a.relation=a.condition.relation,a.value=a.condition.value},f=a.$watch("params",function(){if(a.params){if(a.condition)e();else var b=a.$watch("condition",function(){a.condition&&(e(),b())});f()}});a.keys=function(a){return a?Object.keys(a):void 0},a.isConditionValid=function(){return a.params&&a.condition?a.params[a.prod]&&"number"==typeof a.value:!1},a.$watchGroup(["prod","param","relation","value"],function(){a.condition.construct=a.isConditionValid()?[a.prod,a.param,a.relation,a.value].join(":"):""})}}}),angular.module("dscovrDataApp").controller("VisTsCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location",function(a,b,c,d,e){a.can_plot=!1;var f=function(c){a.selection_strs="",a.$broadcast("evalPanes",function(d){console.log(d);var e=0;a.$broadcast("evalSelections",function(f){++e,console.log(e),f&&(a.selection_strs+=f+";;"),e==d&&(a.selection_strs?(console.log(a.selection_strs),console.log(a.timerange_construct),c&&(console.log("hello"),c()),a.can_plot=!0):(a.error="please enter at least 1 valid pane",b(function(){a.error=""},5e3)))})})},g=function(){a.plots=[];var d=a.timerange_construct;console.log(a.selection_strs),a.selection_strs.split(";;").map(function(e){if(e){var f=e.split("$$");if(e=f[0],f[1]){var g=f[1].split("*")[0],h=[],i=[];g.split(";").map(function(a){var b=a.split("_");0==b[1]?i.push(b[0]):h.push(b[0])}),h=h.join(";"),i=i.join(";"),h&&";"!=h.charAt(h.length-1)&&(h+=";"),i&&";"!=i.charAt(i.length-1)&&(i+=";")}{Boolean(e.split("*")[1])}console.log(h),";"==e.charAt(e.length-1)&&(e=e.slice(0,-1));var j=e.split(";").map(function(a){return a.split(":")[1]}),k=0,l=!1,m=!1;c.getValues(e,d).then(function(f){if(h)c.getValues(e,h+d).then(function(g){var h=[];for(var n in g)h.push(g[n].time);if(i)c.getValues(e,i+d).then(function(c){var i=[];for(var n in c)i.push(c[n].time);for(;k<f.length;){var o=i.indexOf(f[k].time);if(-1!=o)m?(f.splice(k,1),i.splice(o,1)):(Object.keys(f[k]).map(function(a){"time"!=a&&(f[k][a]=null)}),i.splice(o,1),m=!0);else{var p=0;if(Object.keys(f[k]).map(function(a){-9999==+f[k][a]|-999==+f[k][a]&&(p++,f[k][a]=null)}),l=Boolean(p==j.length),l&&m)f.splice(k,1);else{var q=h.indexOf(f[k].time);!l&&q>-1?Object.keys(g[q]).map(function(a){"time"!=a&&(f[k]["condition"+a]=-9999!=+g[q][a]?g[q][a]:null)}):l||-1!=q||Object.keys(f[k]).map(function(a){"time"!=a&&(f[k]["condition"+a]=null)}),f[k].time=new Date(+f[k].time),m=l,k++}}}var r=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to "),s=[];j.map(function(a){s.push(a),s.push("condition"+a)}),a.plots.push({y_accessor:s,data:f,title:r}),b(function(){for(var a=2;a<s.length+1;)d3.select(".mg-line"+a+"-color").style({"stroke-width":5}),a+=2},3e3)});else{for(;k<f.length;){var o=0;if(Object.keys(f[k]).map(function(a){-9999==+f[k][a]|-999==+f[k][a]&&(o++,f[k][a]=null)}),l=Boolean(o==j.length),l&&m)f.splice(k,1);else{var p=h.indexOf(f[k].time);!l&&p>-1?Object.keys(g[p]).map(function(a){"time"!=a&&(f[k]["condition"+a]=-9999!=+g[p][a]?g[p][a]:null)}):l||-1!=p||Object.keys(f[k]).map(function(a){"time"!=a&&(f[k]["condition"+a]=null)}),f[k].time=new Date(+f[k].time),m=l,k++}}var q=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to "),r=[];j.map(function(a){r.push(a),r.push("condition"+a)}),a.plots.push({y_accessor:r,data:f,title:q}),b(function(){for(var a=2;a<r.length+1;)d3.select(".mg-line"+a+"-color").style({"stroke-width":5}),a+=2},3e3)}});else if(i)c.getValues(e,i+d).then(function(b){var c=[];for(var g in b)c.push(b[g].time);for(;k<f.length;){var h=c.indexOf(f[k].time);if(-1!=h)m?(f.splice(k,1),c.splice(h,1)):(Object.keys(f[k]).map(function(a){"time"!=a&&(f[k][a]=null)}),c.splice(h,1),m=!0);else{var i=0;Object.keys(f[k]).map(function(a){-9999==+f[k][a]|-999==+f[k][a]&&(i++,f[k][a]=null)}),l=Boolean(i==j.length),l&&m?f.splice(k,1):(f[k].time=new Date(+f[k].time),m=l,k++)}}var n=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to ");a.plots.push({y_accessor:j,data:f,title:n})});else{for(;k<f.length;){var g=0;Object.keys(f[k]).map(function(a){-9999==+f[k][a]|-999==+f[k][a]&&(g++,f[k][a]=null)}),l=Boolean(g==j.length),l&&m?f.splice(k,1):(f[k].time=new Date(+f[k].time),m=l,k++)}var n=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to ");a.plots.push({y_accessor:j,data:f,title:n})}})}})};a.go=function(){f(),a.can_plot&&(console.log("/vis/ts/"+a.selection_strs+a.timerange_construct),e.url("/vis/ts/"+a.selection_strs+"/"+a.timerange_construct))},d.arg&&(a.predef_cond=[],d.arg.split(";;").map(function(b){b&&a.predef_cond.push(b)}),console.log(a.predef_cond),a.predef_time=[0,0],d.argg.split(";").map(function(b){b=b.split(":"),"time"==b[1]&&("ge"==b[2]?a.predef_time[0]=b[3]:a.predef_time[1]=b[3])}),b(function(){f(g)},1e3)),a.timerange_construct="",c.getParameters().then(function(b){a.params=b})}]),angular.module("dscovrDataApp").controller("VisScatterCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location",function(a,b,c,d,e){a.can_plot=!1;var f=function(){a.$broadcast("evalSelections",function(c){c&&2==c.split(";").length?(a.selection_str=c,a.$broadcast("evalConditions",function(c){c?a.condition_str=c:(a.condition_str="",a.error="Using no conditions",b(function(){a.error=""},5e3)),a.can_plot=!0})):(a.error="please select some parameters to plot",b(function(){a.error=""},5e3))})},g=function(){f();var b=a.selection_str,d=a.timerange_construct,e=a.condition_str+d;c.getValues(b,e).then(function(c){a.plots=[];for(var d=b.split(";")[0].split(":")[1],e=b.split(";")[1].split(":")[1],f=0;f<c.length;){var g=0;Object.keys(c[f]).map(function(a){-9999==+c[f][a]|-999==+c[f][a]&&(g++,c[f][a]=null)}),g?c.splice(f,1):(c[f].time=new Date(+c[f].time),f++)}var h={data:c,title:e+" vs "+d,y_accessor:e,x_accessor:d};console.log(c),a.plots.push(h)})};a.go=function(){f(),a.can_plot&&e.url("/vis/scatter/"+a.selection_str+"/"+a.condition_str+a.timerange_construct)},d.arg&&d.argg&&(a.predef_param=[],a.predef_cond=[],a.predef_time=[],a.predef_param=d.arg.split(";"),d.argg.split(";").map(function(b){b=b.split(":"),"time"==b[1]?"ge"==b[2]?a.predef_time[0]=b[3]:a.predef_time[1]=b[3]:a.predef_cond.push(b)}),console.log(a.predef_cond),b(g,1e3)),a.timerange_construct="",c.getParameters().then(function(b){a.params=b})}]),angular.module("dscovrDataApp").directive("tsParamContainer",function(){return{template:'<div class="row"><div class="col-xs-6"><div class="row"><div class="col-xs-5"><h3> Panel config </h3></div><div class="col-xs-2"><a class="btn btn-default" ng-click=addPane()> + panel </a></div></div></div></div><div class="row paneEdit"><div class="col-xs-12"><div ts-param-pane class="ts-param-pane" params="params" pane="default_pane" removable="false" position="0"></div></div></div><div class="row pnaeEdit" ng-repeat="pane in panes"><div class="col-xs-12"><div ts-param-pane class="ts-param-pane" params="params" pane="pane" removable="true" rm-pane="rmPane($index)" position="getPosition(pane)"></div></div></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.default_pane={},a.panes=[];var b=a.$watch("predef",function(){if(console.log(a.predef),a.predef){for(var c in a.predef){var d={predef:a.predef[c]};0==c?a.default_pane=d:a.panes.push(d)}b()}});a.addPane=function(){var b={};a.panes.push(b)},a.getPosition=function(b){return b==a.default_pane?0:a.panes.indexOf(b)+1},a.rmPane=function(b){a.panes.splice(b,1)},a.$on("evalPanes",function(b,c){console.log("evalPanes"),c(a.panes.length+1)})}}}),angular.module("dscovrDataApp").directive("timeRange",function(){return{template:'<div class="row"><div class="col-xs-4"><h3> Select Date Range </h3></div></div><div class="row" style="margin-bottom: 15px"><div class="col-xs-3"><h5> Begin </h5><quick-datepicker ng-model="selected_begin" on-change="onchange()" icon-class="glyphicon glyphicon-calendar" timezone="UTC"></quick-datepicker></div><div class="col-xs-3"><h5> End </h5><quick-datepicker ng-model="selected_end" on-change="onchange()" icon-class="glyphicon glyphicon-calendar" timezone="UTC"></quick-datepicker></div></div>',restrict:"A",scope:{construct:"=",predef:"="},link:function(a){a.selected_begin=moment(14389272e5).toDate(),a.selected_end=moment(14400504e5).toDate();var b=a.$watch("predef",function(){a.predef&&(a.selected_begin=new Date(+a.predef[0]),a.selected_end=new Date(+a.predef[1]),b())});a.construct="",a.construct+="m1m:time:ge:"+a.selected_begin.getTime()+";",a.construct+="m1m:time:le:"+a.selected_end.getTime(),a.onchange=function(){a.construct="",a.construct+="m1m:time:ge:"+a.selected_begin.getTime()+";",a.construct+="m1m:time:le:"+a.selected_end.getTime()}}}}),angular.module("dscovrDataApp").directive("tsParamPane",function(){return{template:'<div class="row"><div class="col-xs-5"><div class="row"><div class="col-xs-6"><h4> Panel {{position}}</h4></div><div class="col-xs-3"><a class="btn btn-default" ng-click=addSelection()> + param </a></div><div class="col-xs-2" ng-if="removable"><a class="btn btn-default" ng-click=rmPane()> - panel </a></div></div><div class="row pane-edit"><div param-edit params="params" selection="default_selection" removable="false"></div></div><div class="row pane-edit" ng-repeat="selection in selections"><div param-edit params="params" selection="selection" removable="true" rm-selection="rmSelection($index)"></div></div></div><div class="col-xs-7"><div class="row"><div class="col-xs-5" ng-if="adv.show"><a ng-click="adv.show = !adv.show"><h4><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span> Advanced options </h4></a></div><div class="col-xs-5" ng-if="!adv.show"><a ng-click="adv.show = !adv.show"><h4><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Advanced options </h4></a></div></div><div class="row" ng-show="adv.show"><form><div class="checkbox"><label><input type="checkbox" ng-model="adv.log">Log scale</label></div></form></div><div class="row" ng-show="adv.show"><div ts-condition-container params="params" predef="predef_cond"></div></div></div></div>',restrict:"A",scope:{params:"=",pane:"=",rmPane:"&",position:"="},link:function(a,b,c){a.default_selection={},a.selections=[],a.adv={log:!1},a.$watch("removable",function(){a.removable=a.$eval(c.removable)}),a.$watch("pane",function(){if(console.log(a.pane),a.pane.predef){var b=a.pane.predef.split("*")[1];";"==b.charAt(b.length-1)&&(b=b.slice(0,-1)),a.adv.log="true"==b;var c=a.pane.predef.split("$$")[0].split(";");for(var d in c)if(c[d]){var e=c[d].split(":"),f={prod:e[0],param:e[1]};0==d?a.default_selection=f:a.selections.push(f)}var g=a.pane.predef.split("$$")[1].split("*")[0];a.predef_cond=g.split(";")}}),a.addSelection=function(){var b={};a.selections.push(b)},a.rmSelection=function(b){a.selections.splice(b,1)},a.evalSelections=function(){var b="";a.default_selection.construct&&(b=a.default_selection.construct+";");for(var c in a.selections)a.selections[c].construct&&(b+=a.selections[c].construct+";");return b},a.$on("evalSelections",function(b,c){console.log("evalSelections cb"),a.$broadcast("evalConditions",function(b){console.log("evalConditions cb");var d=a.evalSelections();d+="$$"+b,d+="*"+a.adv.log,c(d)})})}}}),angular.module("dscovrDataApp").directive("paramEdit",function(){return{template:'<div class="col-xs-8"><select class="form-control param-edit-select" ng-model="prod" ng-options="prod for prod in keys(params)"><option value="" disabled selected>-product-</option></select><select class="form-control param-edit-select" ng-model="param" ng-options="param for param in keys(params[prod])"><option value="" disabled selected>-variable-</option></select></div><div class="col-xs-4" ng-if="removable"><a class="btn btn-default" ng-click=rmSelection()> - param </a></div>',restrict:"A",scope:{params:"=",selection:"=",rmSelection:"&"},link:function(a,b,c){var d=a.$watch("removable",function(){a.removable=a.$eval(c.removable),d()}),e=function(){a.prod=a.selection.prod,a.param=a.selection.param},f=a.$watch("params",function(){if(a.params){if(a.selection)console.log(a.selection),e();else var b=a.$watch("selection",function(){a.selection&&(e(),b())});f()}});a.$watchGroup(["prod","param"],function(){a.selection.construct=a.param&&a.prod?[a.prod,a.param].join(":"):""}),a.keys=function(a){return a?Object.keys(a):void 0}}}}),angular.module("dscovrDataApp").directive("scatterParamPane",function(){return{template:'<div class="row"><div class="col-xs-4"><h3> What to Plot </h3></div></div><div class="row paneEdit"><div class="col-xs-1"><h5> x-axis: </h5></div><div class="col-xs-6"><div param-edit params="params" selection="selection_x" removable="false"></div></div></div><div class="row paneEdit"><div class="col-xs-1"><h5> y-axis: </h5></div><div class="col-xs-6"><div param-edit params="params" selection="selection_y" removable="false"></div></div></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.selection_y={},a.selection_x={};var b=a.$watch("predef",function(){if(a.predef){var c=a.predef[0].split(":"),d=a.predef[1].split(":");a.selection_x.prod=c[0],a.selection_x.param=c[1],a.selection_y.prod=d[0],a.selection_y.param=d[1],b()}});a.evalSelections=function(){var b="";return a.selection_x.construct&&(b=a.selection_x.construct+";"),a.selection_y.construct&&(b+=a.selection_y.construct),b},a.$on("evalSelections",function(b,c){c(a.evalSelections())})}}}),angular.module("dscovrDataApp").factory("dscovrDataAccess",["$http","$q",function(a,b){var c="//gis.ngdc.noaa.gov/dscovr-data-access/";return{getProducts:function(){return a.get(c+"products").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getParameters:function(){return a.get(c+"parameters").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getValues:function(d,e){var f=c+"values?parameters="+d+"&criteria="+e;return console.log(f),a.get(f).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getFiles:function(d,e){var f=c+"files?start_date="+d+"&end_date="+e;return a.get(f).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})}}}]),angular.module("dscovrDataApp").directive("tsPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){a.$watch("plot",function(){a.plot.data&&MG.data_graphic({title:a.plot.title,data:a.plot.data,width:b[0].clientWidth,height:400,yax_format:d3.format("e"),target:b[0],x_accessor:"time",y_accessor:a.plot.y_accessor,legend:a.plot.y_accessor,utc_time:!0,area:!1})})}}}),angular.module("dscovrDataApp").directive("scatterPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){a.$watch("plot",function(){a.plot.data&&(console.log(a.plot.data),MG.data_graphic({title:a.plot.title,chart_type:"point",data:a.plot.data,width:b[0].clientWidth,height:500,target:b[0],x_accessor:a.plot.x_accessor,y_accessor:a.plot.y_accessor}))})}}}),angular.module("dscovrDataApp").directive("eventPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){a.$watch("plot",function(){a.plot.data&&(a.plot.data.map(function(a){return a.time=new Date(+a.time),a.val=1,a}),MG.data_graphic({title:a.plot.title,chart_type:"point",data:a.plot.data,width:b[0].clientWidth,height:100,target:b[0],x_accessor:"time",y_accessor:"val"}))})}}}),angular.module("dscovrDataApp").directive("tsConditionContainer",function(){return{template:'<div class="row" style="margin-top: 20px; margin-bottom: 20px;"><div class="col-xs-4"><h5>Filter where:</h5></div><div class="col-xs-2"><a class="btn btn-default" ng-click=addExclude()> + condition </a></div></div><div class="row conditionEdit"><div condition-edit params="params" condition="default_exclude" removable="false"></div></div><div class="row conditionEdit" ng-repeat="exclude in excludes"><div condition-edit params="params" condition="exclude" removable="true" rm-condition="rmExclude($index)"></div></div><div class="row" style="margin-top: 20px; margin-bottom: 20px;"><div class="col-xs-4"><h5>Highlight where:</h5></div><div class="col-xs-2"><a class="btn btn-default" ng-click=addHighlight()> + condition </a></div></div><div class="row conditionEdit"><div condition-edit params="params" condition="default_highlight" removable="false"></div></div><div class="row conditionEdit" ng-repeat="highlight in highlights"><div condition-edit params="params" condition="highlight" removable="true" rm-condition="rmHighlight($index)"></div></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.default_highlight={},a.highlights=[],a.default_exclude={},a.excludes=[];var b=a.$watch("predef",function(){if(a.predef){console.log(a.predef);var c=!0,d=!0;for(var e in a.predef)if(a.predef[e]){var f=a.predef[e].split("_")[0].split(":"),g=a.predef[e].split("_")[1],h={prod:f[0],param:f[1],relation:f[2],value:Number(f[3])};0==+g?c?(a.default_exclude=h,c=!1):a.excludes.push(h):d?(a.default_highlight=h,d=!1):a.highlights.push(h)}b()}});a.addHighlight=function(){var b={};a.highlights.push(b)},a.rmHighlight=function(b){a.highlights.splice(b,1)},a.addExclude=function(){var b={};a.excludes.push(b)},a.rmExclude=function(b){a.excludes.splice(b,1)},a.evalString=function(){var b="";a.default_exclude.construct&&(b=a.default_exclude.construct+"_0;");for(var c in a.excludes)a.excludes[c].construct&&(b+=a.excludes[c].construct+"_0;");a.default_highlight.construct&&(b+=a.default_highlight.construct+"_1;");for(var c in a.highlights)a.highlights[c].construct&&(b+=a.highlights[c].construct+"_1;");return b},a.$on("evalConditions",function(b,c){console.log("evalConditions"),c(a.evalString())})}}}),angular.module("dscovrDataApp").directive("downloadTimeRange",function(){return{template:'<div class="row"><div class="col-xs-4"><h3> Select Date Range </h3></div></div><div class="row" style="margin-bottom: 15px"><div class="col-xs-3"><h5> Begin </h5><quick-datepicker ng-model="selected_begin" on-change="onchange()" icon-class="glyphicon glyphicon-calendar" timezone="UTC"></quick-datepicker></div><div class="col-xs-3"><h5> End </h5><quick-datepicker ng-model="selected_end" on-change="onchange()" icon-class="glyphicon glyphicon-calendar" timezone="UTC"></quick-datepicker></div></div>',restrict:"A",scope:{predef:"="},link:function(a){a.selected_begin=moment(14389272e5).toDate(),a.selected_end=moment(a.selected_begin).subtract(70,"days").toDate();var b=a.$watch("predef",function(){a.predef&&(a.selected_begin=new Date(+a.predef[0]),a.selected_end=new Date(+a.predef[1]),b())});a.onchange=function(){a.$emit("datechange",[a.selected_begin.getTime(),a.selected_end.getTime()])}}}});