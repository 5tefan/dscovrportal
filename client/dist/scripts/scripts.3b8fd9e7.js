"use strict";angular.module("dscovrDataApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngQuickDate"]).config(["$routeProvider","ngQuickDateDefaultsProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/vis",{redirectTo:"/vis/summary"}).when("/vis/summary/:arg?/:argg?",{templateUrl:"views/vis/summary.html",controller:"VisSummaryCtrl"}).when("/vis/ts/:arg?/:argg?",{templateUrl:"views/vis/ts.html",controller:"VisTsCtrl"}).when("/vis/scatter/:arg?/:argg?",{templateUrl:"views/vis/scatter.html",controller:"VisScatterCtrl"}).when("/vis/event/:arg?",{templateUrl:"views/vis/event.html",controller:"VisEventCtrl"}).when("/download/:arg?/:argg?",{templateUrl:"views/download.html",controller:"DownloadCtrl"}).otherwise({redirectTo:"/"});var c=moment.utc("02-03-2015","DD-MM-YYYY"),d=moment.utc("12-13-2015","DD-MM-YYYY");b.set("dateFilter",function(a){return a=moment(a),a.isAfter(c)&&a.isBefore(d)}),b.set("placeholder","---------------")}]),angular.module("dscovrDataApp").controller("MainCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.scrollTo=function(a){b.hash(a),c()}}]),angular.module("dscovrDataApp").controller("NavCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path().split("/")[1]}}]),angular.module("dscovrDataApp").controller("DownloadCtrl",["$scope","$routeParams","$cookieStore","$location","dscovrDataAccess",function(a,b,c,d,e){if(e.getProducts().then(function(c){if(b.argg){var d=b.argg.split(";");a.products=c.map(function(a){return d.indexOf(a.product)>-1&&(a.selected=!0),a})}else a.products=c.map(function(a){return a.selected=!0,a})}),b.arg){var f=b.arg.split(";");2!=f.length||isNaN(f[0])||isNaN(f[1])||(e.getFiles(f[0],f[1]).then(function(b){a.files=b}),a.predef_time=f)}a.make_wget=function(){if(a.files){var b=[];for(var c in a.products)a.products[c].selected&&b.push(a.products[c].product);var d=[];d.push("wget");for(var c in a.files)for(var e in b)d.push(a.files[c][b[e]]);return d.join(" ")}},a.$on("datechange",function(b,c){var e=[];for(var f in a.products)a.products[f].selected&&e.push(a.products[f].product);console.log(c),d.url("/download/"+c.join(";")+"/"+e.join(";"))})}]),angular.module("dscovrDataApp").controller("VisAdvancedCtrl",["$scope","$routeParams","$cookieStore","$location",function(a){a.mission_start=moment.utc("02-03-2015","DD-MM-YYYY"),a.mission_end=moment.utc("12-12-2015","DD-MM-YYYY");moment.range(a.mission_start,a.mission_end);a.make_urldate=function(a){return moment.utc(a).toDate().getTime()/1e5},a.parse_urldate=function(a){return moment.utc(1e5*a)}}]),angular.module("dscovrDataApp").controller("VisSummaryCtrl",["$scope","$routeParams","$cookieStore","$location",function(a,b,c,d){a.mission_start=moment.utc("02-03-2015","DD-MM-YYYY"),a.mission_end=moment.utc("12-12-2015","DD-MM-YYYY");var e=moment.range(a.mission_start,a.mission_end);switch(a.make_urldate=function(a){return moment.utc(a).toDate().getTime()/1e5},a.parse_urldate=function(a){return moment.utc(1e5*a)},a.summary_frame_info={"6h":{dt:864e5,src:"plots/dscovr_6hr_plots/{{year}}/{{month}}/{{year}}{{month}}{{day}}{{hour}}-6hr.png"},"1d":{dt:864e5,src:"plots/dscovr_1day_plots/{{year}}/{{month}}/{{year}}{{month}}{{day}}-day.png"},"3d":{dt:2592e5,src:"plots/dscovr_3day_plots/{{year}}/{{year}}{{month}}{{day}}-3day.png"},"7d":{dt:6048e5,src:"plots/dscovr_7day_plots/{{year}}/{{year}}{{month}}{{day}}-7day.png"},"1m":{dt:27648e5,src:"plots/dscovr_month_plots/{{year}}/{{year}}{{month}}-month.png"}},b.arg){case"6h":case"1d":case"3d":case"7d":case"1m":a.frame_size=b.arg,a.summary_date=moment.utc().subtract(1,"days"),b.argg&&e.contains(a.parse_urldate(b.argg))&&(a.summary_date=a.parse_urldate(b.argg)),a.timestring=a.make_urldate(a.summary_date),a.selected_date=a.summary_date.format("YYYY-MM-DD"),"3d"==a.frame_size||"7d"==a.frame_size?a.summary_file_date=moment.utc(a.mission_start.toDate().getTime()+a.summary_frame_info[a.frame_size].dt*Math.floor((moment.utc(a.selected_date).toDate().getTime()-a.mission_start.toDate().getTime())/a.summary_frame_info[a.frame_size].dt)):"1d"==a.frame_size||"6h"==a.frame_size?a.summary_file_date=moment.utc(a.selected_date).startOf("day"):"1m"==a.frame_size&&(a.summary_file_date=moment.utc(a.selected_date).startOf("month")),a.summary_file_date_prev=moment.utc(a.summary_file_date).subtract(.5*a.summary_frame_info[a.frame_size].dt,"ms"),a.summary_file_date_end=moment.utc(a.summary_file_date).add(a.summary_frame_info[a.frame_size].dt,"ms"),a.summary_file_date_next=moment.utc(a.summary_file_date).add(a.summary_frame_info[a.frame_size].dt,"ms");break;default:return void d.url("/vis/summary/7d")}a.dateselect_locationchange=function(){if(a.selected_date){var c=moment(a.selected_date);d.url("/vis/summary/"+b.arg+"/"+a.make_urldate(c))}},a.get_plotsrc=function(){var b=a.summary_frame_info[a.frame_size].src;return b=b.split("{{year}}").join(a.summary_file_date.format("YYYY")),b=b.split("{{month}}").join(a.summary_file_date.format("MM")),b=b.split("{{day}}").join(a.summary_file_date.format("DD"))},a.get_plotsrc_6h=function(b){var c=a.summary_frame_info[a.frame_size].src;return c=c.split("{{year}}").join(a.summary_file_date.format("YYYY")),c=c.split("{{month}}").join(a.summary_file_date.format("MM")),c=c.split("{{day}}").join(a.summary_file_date.format("DD")),c=c.split("{{hour}}").join(10>b?"0"+b:b)}}]),angular.module("dscovrDataApp").controller("VisEventCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location",function(a,b,c,d,e){a.can_plot=!1;var f=function(){a.$broadcast("evalConditions",function(c){c?(a.criteria=c,a.can_plot=!0):(a.can_plot=!1,a.error="please enter at least 1 valid condition!",b(function(){a.error=""},5e3))})},g=function(){f();var b=a.criteria,d=a.timerange_construct;c.getValues("",b+d).then(function(c){a.plots=[];var d={data:c,title:b};a.plots.push(d)})};a.go=function(){f(),a.can_plot&&e.url("/vis/event/"+a.criteria+a.timerange_construct)},d.arg&&(a.predef_cond=[],a.predef_time=[0,0],d.arg.split(";").map(function(b){b=b.split(":"),"time"==b[1]?"ge"==b[2]?a.predef_time[0]=b[3]:a.predef_time[1]=b[3]:a.predef_cond.push(b)}),b(g,1e3)),a.timerange_construct="",c.getParameters().then(function(b){a.params=b})}]),angular.module("dscovrDataApp").directive("conditionContainer",["$timeout",function(){return{template:'<div class="row"><div class="col-xs-7"><h3> Add constraints </h3></div><div class="col-xs-2"><a class="btn btn-default margin-t15" ng-click=addCondition()> + constraint </a></div></div><div class="row condition-edit" ng-repeat="condition in conditions"><div condition-edit params="params" condition="condition" removable="true" rm-condition="rmCondition($index)"></div></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.conditions=[];var b=a.$watch("predef",function(){if(a.predef){for(var c in a.predef){var d={prod:a.predef[c][0],param:a.predef[c][1],relation:a.predef[c][2],value:Number(a.predef[c][3])};a.conditions.push(d)}b()}});a.addCondition=function(){var b={};a.conditions.push(b)},a.rmCondition=function(b){a.conditions.splice(b,1)},a.evalConditions=function(){var b="";for(var c in a.conditions)a.conditions[c].construct&&(b+=a.conditions[c].construct+";");return b},a.$on("evalConditions",function(b,c){c(a.evalConditions())})}}}]),angular.module("dscovrDataApp").directive("conditionEdit",function(){return{template:'<div class="no-padding-right col-xs-3"><select class="form-control condition-edit-select" ng-model="prod" ng-options="prod for prod in keys(params)"><option value="" disabled selected>-product-</option></select></div><div class="no-padding-right no-padding-left col-xs-3"><select class="form-control condition-edit-select" ng-model="param" ng-options="param for param in keys(params[prod])"><option value="" disabled selected>-variable-</option></select></div><div class="no-padding-right no-padding-left col-xs-1"><select class="form-control condition-edit-select" ng-model="relation"><option value="gt"> &gt; </option><option value="lt"> &lt; </option><option value="eq"> = </option><option value="ge"> &gt;= </option><option value="le"> &lt;= </option></select></div><div class="no-padding-right no-padding-left col-xs-2"><input type="number" class="form-control" placeholder="val" ng-model="value" ng-required></div><div class="col-xs-2" ng-if="removable"><a class="btn btn-default" ng-click=rmCondition($index)> - constraint </a></div></div>',restrict:"A",scope:{params:"=",condition:"=",rmCondition:"&"},link:function(a,b,c){var d=a.$watch("removable",function(){a.removable=a.$eval(c.removable),d()}),e=function(){a.prod=a.condition.prod,a.param=a.condition.param,a.relation=a.condition.relation,a.value=a.condition.value},f=a.$watch("params",function(){if(a.params){if(a.condition)e();else var b=a.$watch("condition",function(){a.condition&&(e(),b())});f()}});a.keys=function(a){return a?Object.keys(a):void 0},a.isConditionValid=function(){return a.params&&a.condition?a.params[a.prod]&&"number"==typeof a.value:!1},a.$watchGroup(["prod","param","relation","value"],function(){a.condition.construct=a.isConditionValid()?[a.prod,a.param,a.relation,a.value].join(":"):""})}}}),angular.module("dscovrDataApp").controller("VisTsCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location",function(a,b,c,d,e){a.can_plot=!1;var f=function(c){return c.length<=1&&(a.error="No data with specified conditions",b(function(){a.error=""},5e3)),c.length>1},g=function(c){a.selection_strs="",a.$broadcast("evalPanes",function(d){console.log(d);var e=0;a.$broadcast("evalSelections",function(f){++e,console.log(e),f&&(a.selection_strs+=f+";;"),e==d&&(a.selection_strs?(console.log(a.selection_strs),console.log(a.timerange_construct),c&&(console.log("hello"),c()),a.can_plot=!0):(a.error="please enter at least 1 valid pane",b(function(){a.error=""},5e3)))})})},h=function(){a.plots=[];var d=a.timerange_construct;console.log(a.selection_strs),a.selection_strs.split(";;").map(function(e){if(e){var g=e.split("$$");e=g[0];var h="linear";if(g[1]){var i=g[1].split("*")[0];h="true"==g[1].split("*")[1]?"log":"linear";var j=[],k=[];i.split(";").map(function(a){var b=a.split("@");0==b[1]?k.push(b[0]):j.push(b[0])}),j=j.join(";"),k=k.join(";"),j&&";"!=j.charAt(j.length-1)&&(j+=";"),k&&";"!=k.charAt(k.length-1)&&(k+=";")}";"==e.charAt(e.length-1)&&(e=e.slice(0,-1));var l=e.split(";").map(function(a){return a.split(":")[1]}),m=0,n=!1,o=!1;c.getValues(e,d).then(function(g){if(j)c.getValues(e,j+d).then(function(i){var j=[];for(var p in i)j.push(i[p].time);if(k)c.getValues(e,k+d).then(function(c){var k=[];for(var p in c)k.push(c[p].time);for(;m<g.length;){var q=k.indexOf(g[m].time);if(-1!=q)o?(g.splice(m,1),k.splice(q,1)):(Object.keys(g[m]).map(function(a){"time"!=a&&(g[m][a]=null)}),k.splice(q,1),o=!0);else{var r=0;if(Object.keys(g[m]).map(function(a){-9999==+g[m][a]|-999==+g[m][a]&&(r++,g[m][a]=null)}),n=Boolean(r==l.length),n&&o)g.splice(m,1);else{var s=j.indexOf(g[m].time);!n&&s>-1?Object.keys(i[s]).map(function(a){"time"!=a&&(g[m]["condition"+a]=-9999!=+i[s][a]?i[s][a]:null)}):n||-1!=s||Object.keys(g[m]).map(function(a){"time"!=a&&(g[m]["condition"+a]=null)}),g[m].time=new Date(+g[m].time),o=n,m++}}}if(f(g)){var t=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to "),u=[];l.map(function(a){u.push(a),u.push("condition"+a)}),a.plots.push({y_accessor:u,data:g,title:t,y_scale_type:h}),b(function(){for(var a=2;a<u.length+1;)d3.select(".mg-line"+a+"-color").style({"stroke-width":5}),a+=2},3e3)}});else{for(;m<g.length;){var q=0;if(Object.keys(g[m]).map(function(a){-9999==+g[m][a]|-999==+g[m][a]&&(q++,g[m][a]=null)}),n=Boolean(q==l.length),n&&o)g.splice(m,1);else{var r=j.indexOf(g[m].time);!n&&r>-1?Object.keys(i[r]).map(function(a){"time"!=a&&(g[m]["condition"+a]=-9999!=+i[r][a]?i[r][a]:null)}):n||-1!=r||Object.keys(g[m]).map(function(a){"time"!=a&&(g[m]["condition"+a]=null)}),g[m].time=new Date(+g[m].time),o=n,m++}}if(f(g)){var s=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to "),t=[];l.map(function(a){t.push(a),t.push("condition"+a)}),a.plots.push({y_accessor:t,data:g,title:s,y_scale_type:h}),b(function(){for(var a=2;a<t.length+1;)d3.select(".mg-line"+a+"-color").style({"stroke-width":5}),a+=2},3e3)}}});else if(k)c.getValues(e,k+d).then(function(b){var c=[];for(var i in b)c.push(b[i].time);for(;m<g.length;){var j=c.indexOf(g[m].time);if(-1!=j)o?(g.splice(m,1),c.splice(j,1)):(Object.keys(g[m]).map(function(a){"time"!=a&&(g[m][a]=null)}),c.splice(j,1),o=!0);else{var k=0;Object.keys(g[m]).map(function(a){-9999==+g[m][a]|-999==+g[m][a]&&(k++,g[m][a]=null)}),n=Boolean(k==l.length),n&&o?g.splice(m,1):(g[m].time=new Date(+g[m].time),o=n,m++)}}if(f(g)){var p=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to ");a.plots.push({y_accessor:l,data:g,title:p,y_scale_type:h})}});else{for(;m<g.length;){var i=0;Object.keys(g[m]).map(function(a){-9999==+g[m][a]|-999==+g[m][a]&&(i++,g[m][a]=null)}),n=Boolean(i==l.length),n&&o?g.splice(m,1):(g[m].time=new Date(+g[m].time),o=n,m++)}if(console.log(g),f(g)){var p=e+" from "+d.split(";").map(function(a){return new Date(Number(a.split(":")[3])).toISOString()}).join(" to ");a.plots.push({y_accessor:l,data:g,title:p,y_scale_type:h})}}})}})};a.go=function(){g(),a.can_plot&&(console.log("/vis/ts/"+a.selection_strs+a.timerange_construct),e.url("/vis/ts/"+a.selection_strs+"/"+a.timerange_construct))},d.arg&&(a.predef_cond=[],d.arg.split(";;").map(function(b){b&&a.predef_cond.push(b)}),console.log(a.predef_cond),a.predef_time=[0,0],d.argg.split(";").map(function(b){b=b.split(":"),"time"==b[1]&&("ge"==b[2]?a.predef_time[0]=b[3]:a.predef_time[1]=b[3])}),b(function(){console.log(a.predef_time),g(h)},1e3)),a.timerange_construct="",c.getParameters().then(function(b){a.params=b})}]),angular.module("dscovrDataApp").controller("VisScatterCtrl",["$scope","$timeout","dscovrDataAccess","$routeParams","$location",function(a,b,c,d,e){a.can_plot=!1;var f=function(c){return c.length<=1&&(a.error="No data with specified conditions",b(function(){a.error=""},5e3)),c.length>1},g=function(){a.$broadcast("evalSelections",function(c){c&&2==c.split(";").length?(a.selection_str=c,a.$broadcast("evalConditions",function(c){c?a.condition_str=c:(a.condition_str="",a.error="Using no conditions",b(function(){a.error=""},5e3)),a.can_plot=!0})):(a.error="please select some parameters to plot",b(function(){a.error=""},5e3))})},h=function(){g();var b=a.selection_str,d=a.timerange_construct,e=a.condition_str+d;c.getValues(b,e).then(function(c){a.plots=[];for(var d=b.split(";")[0].split(":")[1],e=b.split(";")[1].split(":")[1],g=0;g<c.length;){var h=0;Object.keys(c[g]).map(function(a){-9999==+c[g][a]|-999==+c[g][a]&&(h++,c[g][a]=null)}),h?c.splice(g,1):(c[g].time=new Date(+c[g].time),g++)}if(f(c)){var i={data:c,title:e+" vs "+d,y_accessor:e,x_accessor:d};a.plots.push(i)}})};a.go=function(){g(),a.can_plot&&e.url("/vis/scatter/"+a.selection_str+"/"+a.condition_str+a.timerange_construct)},d.arg&&d.argg&&(a.predef_param=[],a.predef_cond=[],a.predef_time=[],a.predef_param=d.arg.split(";"),d.argg.split(";").map(function(b){b=b.split(":"),"time"==b[1]?"ge"==b[2]?a.predef_time[0]=b[3]:a.predef_time[1]=b[3]:a.predef_cond.push(b)}),console.log(a.predef_cond),b(h,1e3)),a.timerange_construct="",c.getParameters().then(function(b){a.params=b})}]),angular.module("dscovrDataApp").directive("tsParamContainer",function(){return{template:'<div class="row ts-param-pane" ng-repeat="pane in panes"><div ts-param-pane params="params" pane="pane" rm-pane="rmPane($index)" position="getPosition(pane)"></div><div class="ts-param-pane-remove-pane" class="col-xs-2"><a ng-if="panes.length > 1" class="btn btn-default" ng-click=rmPane($index)> - panel </a></div></div><div class="ts-param-pane-add-pane" class="col-xs-2"><a class="btn btn-default" ng-click=addPane()> + panel </a></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.panes=[{}];var b=a.$watch("predef",function(){if(console.log(a.predef),a.predef){for(var c in a.predef){var d={predef:a.predef[c]};a.panes.push(d)}b()}});a.addPane=function(){var b={};a.panes.push(b)},a.getPosition=function(b){return a.panes.indexOf(b)+1},a.rmPane=function(b){a.panes.splice(b,1)},a.$on("evalPanes",function(b,c){console.log("evalPanes"),c(a.panes.length)})}}}),angular.module("dscovrDataApp").directive("timeRange",function(){return{template:'<div class="row" style="margin-bottom: 15px"><div class="col-xs-6"><h5> Begin </h5><quick-datepicker ng-model="selected_begin" on-change="onchange()" icon-class="glyphicon glyphicon-calendar"></quick-datepicker></div><div class="col-xs-6"><h5> End </h5><quick-datepicker ng-model="selected_end" on-change="onchange()" icon-class="glyphicon glyphicon-calendar"></quick-datepicker></div></div>',restrict:"A",scope:{construct:"=",predef:"="},link:function(a){a.selected_begin=moment(14389272e5).toDate(),a.selected_end=moment(14400504e5).toDate();var b=a.$watch("predef",function(){a.predef&&(a.selected_begin=new Date(+a.predef[0]),a.selected_end=new Date(+a.predef[1]),a.onchange(),b())});a.construct="",a.construct+="m1m:time:ge:"+a.selected_begin.getTime()+";",a.construct+="m1m:time:le:"+a.selected_end.getTime(),a.onchange=function(){a.construct="",a.construct+="m1m:time:ge:"+a.selected_begin.getTime()+";",a.construct+="m1m:time:le:"+a.selected_end.getTime()}}}}),angular.module("dscovrDataApp").directive("tsParamPane",function(){return{template:'<div class="col-xs-5"><div class="row"><div class="col-xs-5 ts-param-pane-panel-title"><h4 class="ts-param-pane-panel-title"> Panel {{position}}</h4></div><div class="col-xs-3"><a class="btn btn-default" ng-click=addSelection()> + param </a></div></div><div class="row pane-edit"><div param-edit class="ts-param-pane-param-edit" params="params" selection="default_selection" removable="false"></div></div><div class="row pane-edit" ng-repeat="selection in selections"><div param-edit params="params" selection="selection" removable="true" rm-selection="rmSelection($index)"></div></div></div><div class="col-xs-6"><div class="row"><div class="col-xs-11 col-xs-offset-1" ng-if="adv.show"><a ng-click="adv.show = !adv.show"><h4><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span> Advanced options </h4></a></div><div class="col-xs-11 col-xs-offset-1" ng-if="!adv.show"><a ng-click="adv.show = !adv.show"><h4><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span> Advanced options </h4></a></div></div><div class="row" ng-show="adv.show"><form><div class="checkbox"><label><input type="checkbox" ng-model="adv.log">Log scale</label></div></form></div><div class="row" ng-show="adv.show"><div ts-condition-container params="params" predef="predef_cond"></div></div></div>',restrict:"A",scope:{removable:"=",params:"=",pane:"=",rmPane:"&",position:"="},link:function(a){a.default_selection={},a.selections=[],a.adv={log:!1},a.$watch("pane",function(){if(console.log(a.pane),a.pane.predef){var b=a.pane.predef.split("*")[1];";"==b.charAt(b.length-1)&&(b=b.slice(0,-1)),a.adv.log="true"==b;var c=a.pane.predef.split("$$")[0].split(";");for(var d in c)if(c[d]){var e=c[d].split(":"),f={prod:e[0],param:e[1]};0==d?a.default_selection=f:a.selections.push(f)}var g=a.pane.predef.split("$$")[1].split("*")[0];a.predef_cond=g.split(";")}}),a.addSelection=function(){var b={};a.selections.push(b)},a.rmSelection=function(b){a.selections.splice(b,1)},a.evalSelections=function(){var b="";a.default_selection.construct&&(b=a.default_selection.construct+";");for(var c in a.selections)a.selections[c].construct&&(b+=a.selections[c].construct+";");return b},a.$on("evalSelections",function(b,c){console.log("evalSelections cb"),a.$broadcast("evalConditions",function(b){console.log("evalConditions cb");var d=a.evalSelections();d+="$$"+b,d+="*"+a.adv.log,c(d)})})}}}),angular.module("dscovrDataApp").directive("paramEdit",function(){return{template:'<div class="col-xs-8"><select class="form-control param-edit-select" ng-model="prod" ng-options="prod for prod in keys(params)"><option value="" disabled selected>-product-</option></select><select class="form-control param-edit-select" ng-model="param" ng-options="param for param in keys(params[prod])"><option value="" disabled selected>-variable-</option></select></div><div class="col-xs-4" ng-if="removable"><a class="btn btn-default" ng-click=rmSelection()> - param </a></div>',restrict:"A",scope:{params:"=",selection:"=",rmSelection:"&"},link:function(a,b,c){var d=a.$watch("removable",function(){a.removable=a.$eval(c.removable),d()}),e=function(){a.prod=a.selection.prod,a.param=a.selection.param},f=a.$watch("params",function(){if(a.params){if(a.selection)console.log(a.selection),e();else var b=a.$watch("selection",function(){a.selection&&(e(),b())});f()}});a.$watchGroup(["prod","param"],function(){a.selection.construct=a.param&&a.prod?[a.prod,a.param].join(":"):""}),a.keys=function(a){return a?Object.keys(a):void 0}}}}),angular.module("dscovrDataApp").directive("scatterParamPane",function(){return{template:'<div class="row paneEdit"><div class="col-xs-3 no-padding-right"><h4> x-axis: </h4></div><div class="col-xs-9 no-padding-left"><div scatter-param-edit params="params" selection="selection_x" removable="false"></div></div></div><div class="row paneEdit"><div class="col-xs-3 no-padding-right"><h4> y-axis: </h4></div><div class="col-xs-9 no-padding-left"><div scatter-param-edit params="params" selection="selection_y" removable="false"></div></div></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.selection_y={},a.selection_x={};var b=a.$watch("predef",function(){if(a.predef){var c=a.predef[0].split(":"),d=a.predef[1].split(":");a.selection_x.prod=c[0],a.selection_x.param=c[1],a.selection_y.prod=d[0],a.selection_y.param=d[1],b()}});a.evalSelections=function(){var b="";return a.selection_x.construct&&(b=a.selection_x.construct+";"),a.selection_y.construct&&(b+=a.selection_y.construct),b},a.$on("evalSelections",function(b,c){c(a.evalSelections())})}}}),angular.module("dscovrDataApp").factory("dscovrDataAccess",["$http","$q",function(a,b){var c="//gis.ngdc.noaa.gov/dscovr-data-access/";return{getProducts:function(){return a.get(c+"products").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getParameters:function(){return a.get(c+"parameters").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getValues:function(d,e){var f=c+"values?parameters="+d+"&criteria="+e;return console.log(f),a.get(f).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getFiles:function(d,e){var f=c+"files?start_date="+d+"&end_date="+e;return a.get(f).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})}}}]),angular.module("dscovrDataApp").directive("tsPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){a.$watch("plot",function(){a.plot.data&&MG.data_graphic({title:a.plot.title,data:a.plot.data,width:b[0].clientWidth,height:400,right:100,yax_format:d3.format("e"),target:b[0],x_accessor:"time",y_accessor:a.plot.y_accessor,legend:a.plot.y_accessor,utc_time:!0,area:!1,y_scale_type:a.plot.y_scale_type})})}}}),angular.module("dscovrDataApp").directive("scatterPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){a.$watch("plot",function(){a.plot.data&&(console.log(a.plot.data),MG.data_graphic({title:a.plot.title,chart_type:"point",data:a.plot.data,width:b[0].clientWidth,height:500,target:b[0],x_accessor:a.plot.x_accessor,y_accessor:a.plot.y_accessor}))})}}}),angular.module("dscovrDataApp").directive("eventPlot",function(){return{template:"",restrict:"A",scope:{plot:"="},link:function(a,b){a.$watch("plot",function(){a.plot.data&&(a.plot.data.map(function(a){return a.time=new Date(+a.time),a.val=1,a}),MG.data_graphic({title:a.plot.title,chart_type:"point",data:a.plot.data,width:b[0].clientWidth,height:100,target:b[0],x_accessor:"time",y_accessor:"val"}))})}}}),angular.module("dscovrDataApp").directive("tsConditionContainer",function(){return{template:'<div class="row"><div class="col-xs-4"><h5>Constrain where:</h5></div><div class="col-xs-2"><a class="btn btn-default" ng-click=addExclude()> + constraint </a></div></div><div class="row condition-edit" ng-repeat="exclude in excludes"><div condition-edit params="params" condition="exclude" removable="true" rm-condition="rmExclude($index)"></div></div>',restrict:"A",scope:{params:"=",predef:"="},link:function(a){a.highlights=[],a.excludes=[];var b=a.$watch("predef",function(){if(a.predef){for(var c in a.predef)if(a.predef[c]){var d=a.predef[c].split("@")[0].split(":"),e=a.predef[c].split("@")[1],f={prod:d[0],param:d[1],relation:d[2],value:Number(d[3])};0==+e?a.excludes.push(f):a.highlights.push(f)}b()}});a.addHighlight=function(){var b={};a.highlights.push(b)},a.rmHighlight=function(b){a.highlights.splice(b,1)},a.addExclude=function(){var b={};a.excludes.push(b)},a.rmExclude=function(b){a.excludes.splice(b,1)},a.evalString=function(){var b="";for(var c in a.excludes)a.excludes[c].construct&&(b+=a.excludes[c].construct+"@0;");for(var c in a.highlights)a.highlights[c].construct&&(b+=a.highlights[c].construct+"@1;");return b},a.$on("evalConditions",function(b,c){console.log("evalConditions"),c(a.evalString())})}}}),angular.module("dscovrDataApp").directive("downloadTimeRange",function(){return{template:'<div class="row"><div class="col-xs-4"><h3> Select Date Range </h3></div></div><div class="row" style="margin-bottom: 15px"><div class="col-xs-3"><h5> Begin </h5><quick-datepicker ng-model="selected_begin" on-change="onchange()" icon-class="glyphicon glyphicon-calendar"></quick-datepicker></div><div class="col-xs-3"><h5> End </h5><quick-datepicker ng-model="selected_end" on-change="onchange()" icon-class="glyphicon glyphicon-calendar"></quick-datepicker></div></div>',restrict:"A",scope:{predef:"="},link:function(a){a.selected_begin=moment(14389272e5).toDate(),a.selected_end=moment(a.selected_begin).subtract(70,"days").toDate();var b=a.$watch("predef",function(){a.predef&&(a.selected_begin=new Date(+a.predef[0]),a.selected_end=new Date(+a.predef[1]),b())});a.onchange=function(){a.$emit("datechange",[a.selected_begin.getTime(),a.selected_end.getTime()])}}}}),angular.module("dscovrDataApp").directive("scatterParamEdit",function(){return{template:'<div class="col-xs-12"><select class="form-control param-edit-select" ng-model="prod" ng-options="prod for prod in keys(params)"><option value="" disabled selected>-product-</option></select><select class="form-control param-edit-select" ng-model="param" ng-options="param for param in keys(params[prod])"><option value="" disabled selected>-variable-</option></select></div>',restrict:"A",scope:{params:"=",selection:"=",rmSelection:"&"},link:function(a){var b=function(){a.prod=a.selection.prod,a.param=a.selection.param},c=a.$watch("params",function(){if(a.params){if(a.selection)console.log(a.selection),b();else var d=a.$watch("selection",function(){a.selection&&(b(),d())});c()}});a.$watchGroup(["prod","param"],function(){a.selection.construct=a.param&&a.prod?[a.prod,a.param].join(":"):""}),a.keys=function(a){return a?Object.keys(a):void 0}}}});